# patch-legal-env.yaml
# Adds service discovery and object storage configuration for Legal Core Plus
apiVersion: apps/v1
kind: Deployment
metadata:
  name: osdu-legal
spec:
  template:
    spec:
      containers:
        - name: legal
          env:
            # Partition service configuration
            - name: PARTITION_HOST
              value: "http://osdu-partition:8080"
            - name: PARTITION_API
              value: "http://osdu-partition:8080/api/partition/v1"
            - name: PARTITION_SERVICE_ENDPOINT
              value: "http://osdu-partition:8080"
            # Entitlements service configuration
            - name: ENTITLEMENTS_HOST
              value: "http://osdu-entitlements:8080"
            - name: ENTITLEMENTS_URL
              value: "http://osdu-entitlements:8080/api/entitlements/v2"
            - name: AUTHORIZE_API
              value: "http://osdu-entitlements:8080/api/entitlements/v2"
            # Object storage (Ceph/MinIO) configuration
            # OBM_MINIO_SECRET_KEY is resolved from partition property with sensitive=true
            - name: OBM_MINIO_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: rook-ceph-object-user-osdu-store-osdu-s3-user
                  key: SecretKey
            # Postgres password
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: osdu-postgres-secret
                  key: POSTGRES_PASSWORD
            # Enable debug logging for troubleshooting
            - name: LOG_LEVEL
              value: "INFO"
