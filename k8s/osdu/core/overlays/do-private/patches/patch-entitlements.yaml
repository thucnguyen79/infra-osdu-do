apiVersion: apps/v1
kind: Deployment
metadata:
  name: osdu-entitlements
spec:
  template:
    spec:
      # initContainers:
      #   - name: wait-for-partition-osdu
      #     image: curlimages/curl:8.5.0
      #     imagePullPolicy: IfNotPresent
      #     command: ["sh", "-c"]
      #     args:
      #       - |
      #         set -e
      #         echo "[wait] Waiting for Partition service to have partition 'osdu'..."
      #         for i in $(seq 1 120); do
      #           code="$(curl -s -o /dev/null -w "%{http_code}" http://osdu-partition:8080/api/partition/v1/partitions/osdu || true)"
      #           if [ "$code" = "200" ]; then
      #             echo "[wait] Partition 'osdu' is ready."
      #             exit 0
      #           fi
      #           echo "[wait] Not ready yet (HTTP $code). Retry in 5s... ($i/120)"
      #           sleep 5
      #         done
      #         echo "[wait] Timed out waiting for partition 'osdu'."
      #         exit 1
      containers:
        - name: osdu-entitlements
          env:
            # Đảm bảo Partition API đúng path chuẩn của service Partition
            - name: PARTITION_API
              value: "http://osdu-partition:8080/api/partition/v1"
            - name: KEYCLOAK_ISSUER_URI
              valueFrom:
                configMapKeyRef:
                  name: osdu-core-env
                  key: KEYCLOAK_ISSUER_URI
            - name: SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI
              value: "$(KEYCLOAK_ISSUER_URI)"
