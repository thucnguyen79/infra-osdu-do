apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: osdu-core

resources:
  - ../../base
  - marker-configmap.yaml
  - extra/00-keycloak-internal-dns-alias.yaml

patches:
  # Partition
  - path: patches/patch-partition-env.yaml

  # Entitlements
  - path: patches/patch-entitlements-all.yaml

  # Legal
  - path: patches/patch-legal-all.yaml

  # Storage - Kafka + RabbitMQ retry bypass (Step 20)
  - path: patches/patch-storage-kafka.yaml
  - path: patches/patch-storage-rabbitmq.yaml
  # Storage - OpenID + OBM + SSL config (Step 24)
  - path: patches/patch-storage-openid.yaml

  # File - Entitlements config (Step 20)
  - path: patches/patch-file-entitlements.yaml

  # Revision history
  - path: patches/revision-history/patch-partition.yaml
  - path: patches/revision-history/patch-entitlements.yaml
  - path: patches/revision-history/patch-storage.yaml
  - path: patches/revision-history/patch-legal.yaml
  - path: patches/revision-history/patch-schema.yaml
  - path: patches/revision-history/patch-file.yaml
  - path: patches/revision-history/patch-toolbox.yaml
  - path: patches/revision-history/patch-search.yaml
  - path: patches/revision-history/patch-indexer.yaml

  # Indexer - OpenSearch Proxy (Step 27)
  - path: patches/patch-indexer-opensearch-proxy.yaml

generatorOptions:
  disableNameSuffixHash: true

configMapGenerator:
  - name: osdu-core-env
    literals:
      - POSTGRES_HOST=osdu-postgres.osdu-data.svc.cluster.local
      - POSTGRES_PORT=5432
      - REDIS_HOST=osdu-redis.osdu-data.svc.cluster.local
      - REDIS_PORT=6379
      - REDIS_STORAGE_HOST=osdu-redis.osdu-data.svc.cluster.local
      - REDIS_STORAGE_PORT=6379
      - REDIS_GROUP_HOST=osdu-redis.osdu-data.svc.cluster.local
      - REDIS_GROUP_PORT=6379
      - KAFKA_BOOTSTRAP_SERVERS=osdu-kafka.osdu-data.svc.cluster.local:9092
      - OPENSEARCH_HOST=opensearch-proxy.osdu-data.svc.cluster.local
      - OPENSEARCH_PORT=9200
      - KEYCLOAK_ISSUER_URI=http://keycloak.osdu-identity.svc.cluster.local/realms/osdu
      - PARTITION_API=http://osdu-partition:8080/api/partition/v1
      - JAVA_OPTS=-Xms256m -Xmx512m
      - SERVER_PORT=8080

